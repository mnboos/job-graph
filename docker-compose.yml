services:
  graphhopper:
    build:
        context: .
        dockerfile: docker/graphhopper.Dockerfile
    container_name: graphhopper
    deploy:
        resources:
            limits:
                memory: 6g
    memswap_limit: 6g
    ports:
      - "8989:8989"
    volumes:
        - ./data/graphhopper/osm:/osm_data
        - ./data/graphhopper/cache:/graph-cache
        - ./graphhopper-config.yaml:/config.yaml:ro
    environment:
        - OSM_DATA_DIR=/osm_data
        - OSM_DATA_URL=https://download.geofabrik.de/europe/switzerland-latest.osm.pbf
    restart: unless-stopped

  photon:
    build:
      context: .
      dockerfile: docker/photon.Dockerfile
    container_name: photon
    ports:
      - "2322:2322" # Photon runs on port 2322
    volumes:
      - ./data/photon:/photon/photon_data # Persist photon's data
      - ./data/switzerland-latest.osm.pbf:/data/switzerland-latest.osm.pbf:ro
    command: ["-osm-pbf", "/data/switzerland-latest.osm.pbf", "-country-codes", "CH", "-languages", "de,fr,it,en"]
    restart: unless-stopped